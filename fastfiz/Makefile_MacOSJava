# Compiler and compiler flags
CC = gcc
JDKLOC := $(shell /usr/libexec/java_home)
SWIGFLAGS = -c++ -java -package JFastfiz -Iinclude -outdir $(MODULEDIR)
LDFLAGS = -L/opt/homebrew/Cellar/gsl/2.7.1/lib
CFLAGS = -fPIC -std=c++11 \
         -Iinclude \
         -I/opt/homebrew/Cellar/gsl/2.7.1/include \
         -I$(JDKLOC)/include \
         -I$(JDKLOC)/include/darwin

# Source files
SRCDIR = src
SRCFILES = $(wildcard $(SRCDIR)/*.cpp)
SRCWRAP = swig/fastfiz_wrap.cxx

# Object files
OBJFILES = $(SRCFILES:.cpp=.o)

# Target bundle
TARGET = libfastfiz.so

# Target module
MODULEDIR = ../JFastFiz

# Main target
all: $(TARGET)

# Compile fastfiz_wrap.cxx
$(SRCWRAP): swig/fastfiz.i
	swig $(SWIGFLAGS) $<

# Compile source files
%.o: %.cpp
	$(CC) $(CFLAGS) -c $< -o $@

# Link object files to create the final shared library
$(TARGET): $(OBJFILES) $(SRCWRAP)
	$(CC) $(CFLAGS) -shared $(OBJFILES) $(SRCWRAP) -o $@ $(LDFLAGS) -lgsl -lstdc++

# Clean rule
clean:
	rm -f $(OBJFILES) $(SRCWRAP) $(TARGET)
	rm -f $(MODULEDIR)/*.java
